<meta charset="UTF-8">
<link href="/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="/reset.min.css" />
<link rel="shortcut icon" type="image/png" href="/assets/favicon.png" />
<link href="/materialicons.css" rel="stylesheet">

<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brainfuck in rust | Tiny Programs</title>

<a href="/">Home</a>
<h1>Brainfuck in rust</h1>

<a href="https://github.com/eatonphil/tinyprograms/blob/main/Brainfuck/rust/main.rs">Source Code</a>

<section>
  <pre><code>use std::io::{self, Read};
use std::env;
use std::fs;

fn main() {
    let args: Vec<String> = env::args().collect();
    let filename = &args[1];

    let prog: Vec<char> = fs::read_to_string(filename).expect("Could not read file").chars().collect();

    let mut data_stack: [u8;30_000] = [0; 30_000];
    let mut data_pointer: usize = 0;
    let mut instr_stack: Vec<usize> = Vec::new();
    let mut instr_pointer: usize = 0;

    let mut stdin_buf: [u8;1] = [0; 1];
    
    while instr_pointer < prog.len() {
	match prog[instr_pointer] {
	    '>' => {
                data_pointer += 1;
            },
            '<' => {
                data_pointer -= 1;
            },
            '+' => {
                data_stack[data_pointer] += 1;
            },
            '-' => {
                data_stack[data_pointer] -= 1;
            },
            '.' => {
		print!("{}", data_stack[data_pointer] as char);
            },
            ',' => {
		io::stdin().read_exact(&mut stdin_buf).expect("Could not read from stdin");
                data_stack[data_pointer] = stdin_buf[0];
            },
	    '[' => {
		let mut stack = 1;
                let mut end = instr_pointer + 1;
                'outer: loop {
                    match prog[end] {
                        '[' => {
                            stack += 1;
                        },
                        ']' => {
                            stack -= 1;

                            if stack == 0 {
                                break 'outer;
                            }
                        },
                        _ => {},
                    }

                    end += 1;
                }

                if data_stack[data_pointer] == 0 {
                    instr_pointer = end;
                } else {
                    instr_stack.push(instr_pointer);
                }
	    },
	    ']' => {
		let new_pointer = instr_stack.pop().unwrap() - 1;
                if data_stack[data_pointer] != 0 {
                    instr_pointer = new_pointer;
                }
	    },
	    _ => {},
	}

	instr_pointer += 1;
    }
}
</code></pre>
</section>

<section>
  <h2>All implementations</h2>
  <ul>
    
    <li><a href="/Brainfuck/go.html">go</a></li>
    
    <li><a href="/Brainfuck/rust.html">rust</a></li>
    
    <li><a href="/Brainfuck/zig.html">zig</a></li>
    
  </ul>
</section>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/rust.min.js"></script>
<script>hljs.highlightAll();</script>